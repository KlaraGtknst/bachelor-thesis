\newcommand{\databaseName}{Elasticsearch}
\chapter{Implementation}\label{ch:implementation}

\section{Database Elasticsearch}\label{subsec:db}
% introduction, users
\databaseName{} is a widely used non-relational database, which was designed to store and perform full-text search on large corpus of unstructured data \cite{Elasticsearch2017}.
This open-source distributed document-driven database system is build in Java and is based on the Apache Lucene (Java) library for high-speed full-text search \cite{Elasticsearch2017,Elasticsearch2019}.
According to \cite{Elasticsearch2019}, \databaseName{} provides Wikipedia's full-text search and suggestions as well as Github's code search and Stack Overflow's geolocation queries and related questions.
Needless to say, \databaseName{} is prone to handle Big Data and enables near real-time search by index refreshing periods of one second.

% structure
\databaseName{}'s entries, i.e. documents are stored in logical units, so called indices.
% index
As stated in \citeauthor{Elasticsearch2019} and \citeauthor{Elasticsearch2017}'s work, the indices are structured similar to Apache Lucene's inverted index format.
An index can be spread into multiple nodes.
A node is single running instance of \databaseName{} \cite{Elasticsearch2019}.
An index is divided into one or more shards, which can be stored on different servers and enable parallelization \cite{Elasticsearch2019}.

% document
\databaseName{} indices' entries are documents, which are saved in a \ac{json} fromat \cite{Elasticsearch2017}.
A document's fields and field types are defined by the user when initializing the database index.
By default, every field of a document is indexed and searchable \cite{Elasticsearch2019}.

% Replicas
Replicas are copies of shards, which create redundancy and thus, ensure availability \cite{Elasticsearch2019}.


% content
The database is filled once with data from a large unstructured corpus of \acp{pdf}.
After the initialization of the database, it is used for queries. 
Therefore, the procedure is carries out in a completely offline fashion.

The index \textit{Bahamas} stores different embeddings of the text layer information and metadata of the documents.
The structure of the index is presented in \autoref{tbl:Elasticsearch-fields}.

% Please add the following required packages to your document preamble:
% \usepackage[table,xcdraw]{xcolor}
% If you use beamer only pass "xcolor=table" option, i.e. \documentclass[xcolor=table]{beamer}
\begin{table}[]
    \caption{Fields in \databaseName{} database in index \textit{Bahamas}}
    \begin{tabular}{|
    >{\columncolor[HTML]{EFEFEF}}l |p{0.63\textwidth}|}
    \hline
    \cellcolor[HTML]{C0C0C0}\textbf{field name} & \cellcolor[HTML]{C0C0C0}\textbf{field description}                                                        \\ \hline
    \_id                                        & unique identifier of document \texttt{i}                                                 \\ \hline
    doc2vec                                     & doc2vec embedding of \texttt{i}                                                          \\ \hline
    sim\_docs\_tfidf                            & sim\_docs\_tfidf embedding of \texttt{i}                                                 \\ \hline
    google\_univ\_sent\_encoding                & google\_univ\_sent\_encoding embedding of \texttt{i}                                     \\ \hline
    huggingface\_sent\_transformer              & huggingface\_sent\_transformer embedding of \texttt{i}                                   \\ \hline
    inferSent\_AE                               & inferSent\_AE embedding of \texttt{i}                                                    \\ \hline
    pca\_image                                  & two dimensional \ac{pca} version of first page image of \texttt{i}                      \\ \hline
    pca\_kmeans\_cluster                        & Cluster of \texttt{i} identified by KMeans on \ac{pca} version of image                 \\ \hline
    text                                        & text of \texttt{i}                                                                       \\ \hline
    path                                        & path on local maschine to \texttt{i}                                                     \\ \hline
    image                                       & image of first page of \texttt{i}                                                        \\ \hline
    \end{tabular}
    \label{tbl:Elasticsearch-fields}
\end{table}


% query (endpoints)
% get

% search id

% full-text search
The keyword used when performing full-text search in this case is \texttt{match}.
To query for a specific value, one has to specify the \texttt{<field>} of interest and the query value.

\databaseName{} preprocesses the query value before starting the search \cite{Elasticsearch-text-analyser}.
The default preprocessing steps of the so-called default analyser include tokenization and lowercasing \cite{Elasticsearch-standard-analyser}. 
Omitting stop words is disabled by default, but it is possible to provide custom stop words or use the English stop word list \cite{Elasticsearch-standard-analyser}.
It is possible to create custom tokenizers, which split the query value into tokens of a certain maximum length.
In this work, the default analyser is used for the full-text search, since for instance configuring a maximum token length did not seem necessary or likely to improve the results.

Another useful feature of \databaseName{} is the multi-terms synonym expansion.
When the user queries a specific phrase \databaseName{} expands the query to include synonyms of the query terms \cite{Elasticsearch-synonyms}.
The maximum number of expansion terms is set to 50 by default, but can be configured by the user \cite{Elasticsearch-match}.
By default, the multi-terms synonym expansion option is enabled \cite{Elasticsearch-match}.

\databaseName{} also provides the option to perform fuzzy matching instead of exact search.
By default this option is not enabled, but can be enabled and configured individually by the user \cite{Elasticsearch-match}.
In this work, the fuzzy matching option is set to \texttt{AUTO}, which means in terms of keyword or text fields that the allowed Levenshtein Edit Distance, 
i.e. number of characters changed to create an exact match between two terms, to be considered a match, is correlated to the length of the term \cite{Elasticsearch-fuzziness}.
By default, terms of length up to two characters must match exactly, terms of length three to five characters must have an edit distance of one and 
terms of length six or more characters must have an edit distance of two \cite{Elasticsearch-fuzziness}.

% knn-search


columns are embeddings, rows are documents

\begin{figure}[htp] % htp = hier (h), top (t), oder auf einer eigenen Seite (p).
    \centering
    \includesvg[width=0.5\textwidth]{images/PDFs_to_database}
    \caption{Das Logo der Uni Kassel}
    \label{fig:pdf2db}
\end{figure}

\begin{figure}[htp] % htp = hier (h), top (t), oder auf einer eigenen Seite (p).
    \centering
    \includesvg[width=1.0\textwidth]{images/TFIDF_preprocessing}
    \caption{TFIDF Preprocessing}
    \label{fig:preprocessing}
\end{figure}

\section{User Interface}\label{sec:ui}